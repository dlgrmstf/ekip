(function(n){typeof define=="function"&&define.amd?define(["jquery","jstree"],n):n(jQuery)})(function(n){var w=/^\s*$/g,b=/[\\:&!^|()\[\]<>@*'+~#";,= \/${}%]/g,k=function(n){return(n||"").replace(b,"\\$&")},h="data-jstreegrid",c="data-jstreegrid-column",u="jstree-search",d="_DATA_",g=24,l=!1,nt=10,r=function(n,t){return"jstree_"+n+"_grid_"+k(t)+"_col"},a=function(t){return n.makeArray(t.map(function(){return this.id}))},t=function(t,i,u,f){if(f==undefined&&(f=n()),i===null||i===undefined||i.length===0)return f;var e=n(),o=[].concat(u),s;return typeof i=="string"?(s=r(t,i),e=o.map(function(n){return"#"+s+n}).join(", ")):(e=[],i.forEach(function(n){var i=r(t,n);e=e.concat(o.map(function(n){return"#"+i+n}))}),e=e.join(", ")),o.length==1?f.find(e):n(e)},f=!1,i=null,e=0,o=0,v=/<\/?[^>]+>/gi,tt=function(t,i){var r,f,e,u;return i._gridSettings=i._gridSettings||{},i._gridSettings.indent>0?u=i._gridSettings.indent:(r=n("<div><\/div>"),f=t.prev("i"),e=f.parent(),r.addClass(i.get_node("#",!0).attr("class")),e.appendTo(r),r.appendTo(n("body")),u=f.width()||g,e.detach(),r.remove(),i._gridSettings.indent=u),u},y=function(t,i,r,u,f){var e,o;if(u.data=n.extend(!0,{},i.data),i&&i.children_d&&f)for(e=0,o=i.children_d.length;e<o;e++)y(t,t.get_node(i.children_d[e]),r,r.get_node(u.children_d[e]),f)},p=function(n,t){var r=n.get_node(t),i=r.children;return!i||i.length<=0||!r.state.opened?t:p(n,i[i.length-1])},rt=function(n,t){var i,u,r=parseInt(t.settings.grid.columns[0].width,10)+parseInt(t._gridSettings.treeWidthDiff,10);return i=t.get_node(n).parents.length,u=r-i*tt(n,t),r},it=function(n,t,i){var f=n.hasClass("jstree-anchor")?n:n.children("[class~='jstree-anchor']"),r,u=i.settings.grid.columns[0];r="";u.title&&(u.title===d?r=i.get_text(t):t.attr(u.title)&&(r=t.attr(u.title)));r=r.replace(v,"");r&&f.attr("title",r)},s=function(n,t){return n!==undefined&&n!==null?typeof n=="function"?n(t):t.data!==null&&t.data!==undefined&&t.data[n]!==undefined?t.data[n]:"":""};n.jstree.defaults.grid={width:"auto"};n.jstree.plugins.grid=function(b,k){function d(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}this._initialize=function(){var p,w,b,k,d,r,h,v,f,a;if(!this._initialized){var i=this.settings.grid||{},y,e=this.element,r,t=this._gridSettings={columns:i.columns||[],treeClass:"jstree-grid-col-0",context:i.contextmenu||!1,columnWidth:i.columnWidth,defaultConf:{"*display":"inline","*+display":"inline"},isThemeroller:!!this._data.themeroller,treeWidthDiff:0,resizable:i.resizable,draggable:i.draggable,stateful:i.stateful,indent:0,sortOrder:"text",sortAsc:!0,caseInsensitive:i.caseInsensitive,fixedHeader:i.fixedHeader!==!1,width:i.width,height:i.height,gridcontextmenu:i.gridcontextmenu,treecol:0,gridcols:[]},u=t.columns,c=0,o=!1;for(t.gridcontextmenu===!0?t.gridcontextmenu=function(n,t,i,r,u,f,e){return{edit:{label:"Edit",action:function(){var t=f.get_node(i);n._edit(t,u,e)}}}}:t.gridcontextmenu===!1&&(t.gridcontextmenu=!1),r=0,h=i.columns.length;r<h;r++)i.columns[r].tree?(c=r,t.treecol=c):t.gridcols.push(r);for(this.uniq=Math.ceil(Math.random()*1e3),this.rootid=e.attr("id"),p=/msie/.test(navigator.userAgent.toLowerCase()),p&&(w=parseFloat(navigator.appVersion.split("MSIE")[1]),w<8&&(t.defaultConf.display="inline",t.defaultConf.zoom="1")),l||(l=!0,y=[".jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}",".jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}",".jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}",".jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}",".jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}",".jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}",".jstree-grid-hidden {display: none;}",".jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}",".jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}",".jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}",".jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}",".jstree-grid-midwrapper {display: table-row;}",".jstree-grid-width-auto {width:auto;display:block;}",".jstree-grid-column {display: table-cell; overflow: hidden;}",".jstree-grid-ellipsis {text-overflow: ellipsis;}",".jstree-grid-col-0 {width: 100%;}"],n('<style type="text/css">'+y.join("\n")+"<\/style>").appendTo("head")),this.gridWrapper=n("<div><\/div>").addClass("jstree-grid-wrapper").insertAfter(e),this.midWrapper=n("<div><\/div>").addClass("jstree-grid-midwrapper").appendTo(this.gridWrapper),i.width&&this.gridWrapper.width(i.width),i.height&&this.gridWrapper.height(i.height),r=0,h=u.length;r<h;r++)n("<div><\/div>").addClass("jstree-default jstree-grid-column jstree-grid-column-"+r+" jstree-grid-column-root-"+this.rootid).appendTo(this.midWrapper);for(this.midWrapper.children("div:eq("+c+")").append(e),e.addClass("jstree-grid-cell"),t.fixedHeader&&this.gridWrapper.scroll(function(){n(this).find(".jstree-grid-header").css("top",n(this).scrollTop())}),b=n.proxy(this.settings.sort,this),this.settings.sort=function(n,i){var u,c=this.colrefs,o;if(t.sortOrder==="text")o=this.get_text(n).toLowerCase().localeCompare(this.get_text(i).toLowerCase()),u=t.caseInsensitive?o===1:b(n,i)===1;else{var s=this.get_node(n),h=this.get_node(i),r=c[t.sortOrder].value,f=typeof r=="function"?r(s):s.data[r],e=typeof r=="function"?r(h):h.data[r];typeof f&&typeof e!="undefined"&&(u=t.caseInsensitive?f.toLowerCase()>e.toLowerCase():f>e)}return t.sortAsc||(u=!u),u?1:-1},t.draggable&&(n.ui&&n.ui.sortable?n(this.midWrapper).sortable({axis:"x",handle:".jstree-grid-header",cancel:".jstree-grid-separator",start:function(n,t){k=t.item.index()},stop:function(n,i){d=i.item.index();t.columns.splice(d,0,t.columns.splice(k,1)[0])}}):console.warn("[jstree-grid] draggable option requires jQuery UI")),this.searchColumn=function(n){var i={},t;if(typeof n=="object")for(t in n)n.hasOwnProperty(t)&&t%1==0&&t<u.length&&t>=0&&(i[t]=n[t]);o=i;Object.keys(i).length!==0?this.search("someValue"):this.search("");o=!1},r=0,h=u.length;r<h;r++)v=u[r],typeof v.search_callback!="function"&&(v.search_callback=function(t,i){var r=new n.vakata.search(t,!0,{caseSensitive:f.case_sensitive,fuzzy:f.fuzzy});return r.search(i).isMatch});f=this.settings.search;a=f.search_callback;a||(a=function(t,i){var o=new n.vakata.search(t,!0,{caseSensitive:f.case_sensitive,fuzzy:f.fuzzy}),e=o.search(i.text).isMatch,h,r,l;if(!e)for(r=0,l=u.length;r<l;r++)if(c!==r&&(h=u[r],e=o.search(s(h.value,i)).isMatch,e))break;return e});f.search_callback=function(n,t){var f=!1,r,h,i;if(o){for(r in o)if(o.hasOwnProperty(r)){if(h=o[r],h=="")continue;if(i=u[r],f=c==r?i.search_callback(h,t.text,t,i):i.search_callback(h,s(i.value,t),t,i),!f)break}e.trigger("columnSearch_grid.jstree")}else f=a(n,t),e.trigger("omniSearch_grid.jstree");return f};this._initialized=!0}};this.init=function(n,t){k.init.call(this,n,t);this._initialize()};this.bind=function(){k.bind.call(this);this._initialize();this.element.on("move_node.jstree create_node.jstree clean_node.jstree change_node.jstree",n.proxy(function(n,t){var r=this.get_node(t||"#",!0),i=d();this._detachColumns(i);this._prepare_grid(r);this._reattachColumns(i)},this)).on("delete_node.jstree",n.proxy(function(n,i){if(i.node.id!==undefined){var u=this.gridWrapper,r=[i.node.id];i.node&&i.node.children_d&&(r=r.concat(i.node.children_d));t(this.uniq,r,this._gridSettings.gridcols).remove()}},this)).on("show_node.jstree",n.proxy(function(n,t){this._hideOrShowTree(t.node,!1)},this)).on("hide_node.jstree",n.proxy(function(n,t){this._hideOrShowTree(t.node,!0)},this)).on("close_node.jstree",n.proxy(function(n,t){this._hide_grid(t.node)},this)).on("open_node.jstree",n.proxy(function(){},this)).on("load_node.jstree",n.proxy(function(){},this)).on("loaded.jstree",n.proxy(function(){this._prepare_headers();this.element.trigger("loaded_grid.jstree")},this)).on("ready.jstree",n.proxy(function(){var t=this.element.find("[class~='jstree-anchor']:first").outerHeight(),i,r=this.element.attr("class")||"";n('<style type="text/css">div.jstree-grid-cell-root-'+this.rootid+" {line-height: "+t+"px; height: "+t+"px;}<\/style>").appendTo("head");i=r.split(/\s+/).map(function(n){var t=n.match(/^jstree(-|$)/);return t?"":n});this.gridWrapper.addClass(i.join(" "))},this)).on("move_node.jstree",n.proxy(function(t,i){var r=i.new_instance.element;r.find("li > a").each(n.proxy(function(){},this))},this)).on("hover_node.jstree",n.proxy(function(n,i){var r=i.node.id;this._hover_node!==null&&this._hover_node!==undefined&&t(this.uniq,this._hover_node,this._gridSettings.gridcols).removeClass("jstree-hovered");this._hover_node=r;t(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-hovered")},this)).on("dehover_node.jstree",n.proxy(function(n,i){var r=i.node.id;this._hover_node=null;t(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-hovered")},this)).on("select_node.jstree",n.proxy(function(n,i){var r=i.node.id;t(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-clicked");this.get_node(i.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-clicked")},this)).on("deselect_node.jstree",n.proxy(function(n,i){var r=i.node.id;t(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("deselect_all.jstree",n.proxy(function(n,i){var r=i.node||[];t(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-clicked")},this)).on("search.jstree",n.proxy(function(i,r){var v=this.gridWrapper,f=this,o,y=(new Date).getTime(),p=a(r.nodes.filter(".jstree-node")),h,s,c,e,l;if(this.holdingCells={},r.nodes.length){for(s=d(),c=v.find("div.jstree-grid-cell-regular"),this._detachColumns(s),this._data.search.som&&(this._data.search.smc&&(o=r.nodes.add(r.nodes.find(".jstree-node"))),o=(o||r.nodes).add(r.nodes.parentsUntil(".jstree")),c.hide(),o.filter(".jstree-node").each(function(i,r){var u=r.id,i,e;if(u)for(f._prepare_grid(r),i=0,e=f._gridSettings.gridcols.length;i<e;i++)i!==f._gridSettings.treecol&&t(f.uniq,u,f._gridSettings.gridcols[i],n(f._domManipulation.columns[i])).show()})),e=0,l=this._gridSettings.gridcols.length;e<l;e++)e!==this._gridSettings.treecol&&t(f.uniq,p,this._gridSettings.gridcols[e],n(this._domManipulation.columns[e])).addClass(u);this._reattachColumns(s);h=(new Date).getTime();this.element.trigger("search-complete.jstree-grid",[{time:h-y}])}return!0},this)).on("clear_search.jstree",n.proxy(function(n,i){var r=this.gridWrapper,f=a(i.nodes.filter(".jstree-node"));return r.find("div.jstree-grid-cell").show(),t(this.uniq,f,this._gridSettings.gridcols).removeClass(u),!0},this)).on("copy_node.jstree",function(n,t){var i=t.new_instance,u=t.old_instance,r=i.get_node(t.node,!0);return y(u,t.original,i,t.node,!0),i._detachColumns(r.id),i._prepare_grid(r),i._reattachColumns(r.id),!0}).on("show_ellipsis.jstree",n.proxy(function(){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).addClass("jstree-grid-ellipsis"),!0},this)).on("hide_ellipsis.jstree",n.proxy(function(){return this.gridWrapper.find(".jstree-grid-cell").add(".jstree-grid-header",this.gridWrapper).removeClass("jstree-grid-ellipsis"),!0},this)).on("enable_node.jstree",n.proxy(function(n,i){var r=i.node.id;t(this.uniq,r,this._gridSettings.gridcols).removeClass("jstree-disabled");this.get_node(i.node.id,!0).children("div.jstree-grid-cell").removeClass("jstree-disabled")},this)).on("disable_node.jstree",n.proxy(function(n,i){var r=i.node.id;t(this.uniq,r,this._gridSettings.gridcols).addClass("jstree-disabled");this.get_node(i.node.id,!0).children("div.jstree-grid-cell").addClass("jstree-disabled")},this));if(this._gridSettings.isThemeroller)this.element.on("select_node.jstree",n.proxy(function(n,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-active")},this)).on("deselect_node.jstree deselect_all.jstree",n.proxy(function(n,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-active")},this)).on("hover_node.jstree",n.proxy(function(n,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").addClass("ui-state-hover")},this)).on("dehover_node.jstree",n.proxy(function(n,t){t.rslt.obj.children("[class~='jstree-anchor']").nextAll("div").removeClass("ui-state-hover")},this));if(this._gridSettings.stateful)this.element.on("resize_column.jstree-grid",n.proxy(function(n,t,i){localStorage["jstree-root-"+this.rootid+"-column-"+t]=i},this))};this.teardown=function(){var n=this.gridWrapper,t=this.element,i=n.parent();t.detach();n.remove();i.append(t);k.teardown.call(this)};this._clean_grid=function(n,i){var r=this.gridWrapper;n?t(this.uniq,i,this._gridSettings.gridcols).remove():r.find("div.jstree-grid-cell-regular").remove()};this._prepare_headers=function(){var st,l,v=this,r=this._gridSettings,u=r.columns||[],h,ht=r.columnWidth,k=r.resizable||!1,d,g,p,w,s,a=r.isThemeroller,y=a?"themeroller":"regular",ct,tt=!1,lt=this.gridparent,it=this.rootid,at=r.defaultConf,b,rt=0,ut=0,t,ft,et,ot;for(this.parent=lt,this.colrefs={},t=0,ft=u.length;t<ft;t++){d=u[t].headerClass||"";g=u[t].columnClass||"";p=u[t].header||"";do b=String(Math.floor(Math.random()*1e4));while(this.colrefs[b]!==undefined);w=u[t].value?b:"text";this.colrefs[w]=u[t];p&&(tt=!0);h=r.stateful&&localStorage["jstree-root-"+it+"-column-"+t]?localStorage["jstree-root-"+it+"-column-"+t]:u[t].width||ht;et=u[t].minWidth||h;ot=u[t].maxWidth||h;rt=a?7:10;h!=="auto"&&typeof h!="string"&&(h-=rt);l=this.midWrapper.children("div.jstree-grid-column-"+t);s=n("<div><\/div>").css(at).addClass("jstree-grid-div-"+this.uniq+"-"+t+" "+(a?"ui-widget-header ":"")+" jstree-grid-header jstree-grid-header-cell jstree-grid-header-"+y+" "+d+" "+g).html(p);s.addClass((a?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-"+y);this.settings.core.themes.ellipsis===!0&&s.addClass("jstree-grid-ellipsis");s.prependTo(l);s.attr(c,w);ut+=s.outerWidth();ct=n("<div class='jstree-grid-separator jstree-grid-separator-"+y+(a?" ui-widget-header":"")+(k?" jstree-grid-resizable-separator":"")+"'>&nbsp;<\/div>").appendTo(s);l.width(h);l.css("min-width",et);l.css("max-width",ot)}if(s.addClass((a?"ui-widget-header ":"")+"jstree-grid-header jstree-grid-header-last jstree-grid-header-"+y),u[u.length-1].width===undefined&&(ut-=h,l.css({width:"auto"}),s.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()),tt?r.header=st:n("div.jstree-grid-header").hide(),!this.bound&&k){this.bound=!0;n(document).mouseup(function(){var t,o,e,s,r,u;f&&(u=i.prevAll(".jstree-grid-column").length,r=i.closest(".jstree-grid-wrapper").find(".jstree"),t=n.jstree.reference(r),o=t.settings.grid.columns,s=i.parent().children("div.jstree-grid-column"),(isNaN(u)||u<0)&&(t._gridSettings.treeWidthDiff=r.find("ins:eq(0)").width()+r.find("[class~='jstree-anchor']:eq(0)").width()-t._gridSettings.columns[0].width),e=t._gridSettings.columns[u].width=parseFloat(i.css("width")),f=!1,i=null,r.trigger("resize_column.jstree-grid",[u,e]))}).mousemove(function(n){if(f){o=n.pageX;var t=o-e,s,u,r;t!==0&&(s=i.width(),u=parseFloat(i.css("width")),u||(u=i.innerWidth()),t=t<0?Math.max(t,-s):t,r=u+t,(t>0||s>0)&&r>nt&&(i.width(r+"px"),i.css("min-width",r+"px"),i.css("max-width",r+"px"),e=o))}});this.gridWrapper.on("selectstart",".jstree-grid-resizable-separator",function(){return!1}).on("mousedown",".jstree-grid-resizable-separator",function(t){return f=!0,e=t.pageX,i=n(this).closest("div.jstree-grid-column"),!1}).on("dblclick",".jstree-grid-resizable-separator",function(){var e=n(this),t=e.closest("div.jstree-grid-column"),f=parseFloat(t.css("width")),u=0,i,o=t.prevAll(".jstree-grid-column").length,s=t.width(),r;t.find(".jstree-grid-cell").each(function(){var t=n(this),i;t.css("position","absolute");t.css("width","auto");i=t.outerWidth();t.css("position","relative");i>u&&(u=i)});i=u-f;i=i<0?Math.max(i,-s):i;r=f+i+"px";t.width(r);t.css("min-width",r);t.css("max-width",r);n(this).closest(".jstree-grid-wrapper").find(".jstree").trigger("resize_column.jstree-grid",[o,r])}).on("click",".jstree-grid-separator",function(n){n.stopPropagation()})}this.gridWrapper.on("click",".jstree-grid-header-cell",function(){var t,i,u;v.sort&&(t=n(this).attr(c),r.sortOrder===t&&r.sortAsc===!0?(r.sortAsc=!1,i="&darr;"):(r.sortOrder=t,r.sortAsc=!0,i="&uarr;"),n(this.closest(".jstree-grid-wrapper")).find(".jstree-grid-sort-icon").remove(),n("<span><\/span>").addClass("jstree-grid-sort-icon").appendTo(n(this)).html(i),u=v.get_node("#"),v.sort(u,!0),v.redraw_node(u,!0))})};this._domManipulation=null;this._detachColumns=function(n){var t,i;if(this._domManipulation==null){var r=this._gridSettings.columns||[],f=this._gridSettings.treecol,u=this.midWrapper;for(this._domManipulation={id:n,columns:{}},t=0,i=r.length;t<i;t++)this._domManipulation.columns[t]=u.children(".jstree-grid-column-"+t)[0],this._domManipulation.columns[t].parentNode.removeChild(this._domManipulation.columns[t])}return this._domManipulation};this._reattachColumns=function(n){var t,i;if(this._domManipulation==null)return!1;if(this._domManipulation.id===n){var r=this._gridSettings.columns||[],f=this._gridSettings.treecol,u=this.midWrapper;for(t=0,i=r.length;t<i;t++)u[0].appendChild(this._domManipulation.columns[t]);this._domManipulation=null}return!0};this.open_node=function(t,i,r){var e=n.isArray(t),u=null,f,o;if(e||(u=this.get_node(t),u.id!=="#"))return f=e?d():u.id,this._detachColumns(f),o=k.open_node.call(this,t,i,r),this._reattachColumns(f),o};this.redraw_node=function(t,i,r,u){var f=n.isArray(t)?d():this.get_node(t).id;return this._detachColumns(f),t=k.redraw_node.call(this,t,i,r,u),t&&this._prepare_grid(t),this._reattachColumns(f),t};this.refresh=function(){return this._clean_grid(),k.refresh.apply(this,arguments)};this.set_id=function(i){var u,f=this.uniq,o,s,e;return i&&(u=i.id),o=k.set_id.apply(this,arguments),o&&u!==undefined&&(s=this.gridWrapper,e=[u],i&&i.children_d&&(e=e.concat(i.children_d)),t(f,e,this._gridSettings.gridcols).attr(h,i.id).removeClass(r(f,u)).addClass(r(f,i.id)).each(function(t,u){n(u).attr("id",r(f,i.id)+(t+1))})),o};this._hideOrShowTree=function(n,t){this._detachColumns(n.id);this._hideOrShowNode(n,t,this._gridSettings.columns||[],this._gridSettings.treecol);this._reattachColumns(n.id)};this._hideOrShowNode=function(i,r,u,f){for(var s,e=0,o=u.length;e<o;e++)e!==f&&(s=t(this.uniq,i.id,e,n(this._domManipulation.columns[e])),r?s.addClass("jstree-grid-hidden"):s.removeClass("jstree-grid-hidden"));if(i.state.opened&&i.children)for(e=0,o=i.children.length;e<o;e++)this._hideOrShowNode(this.get_node(i.children[e]),r,u,f)};this._hide_grid=function(i){var u,o,f,r,s;if(!i)return!0;this._detachColumns(i.id);var e=i.children?i.children:[],h=this._gridSettings.columns||[],c=this._gridSettings.treecol;for(u=0,o=e.length;u<o;u++){for(f=this.get_node(e[u]),r=0,s=h.length;r<s;r++)r!==c&&t(this.uniq,f.id,r,n(this._domManipulation.columns[r])).remove();f.state.opened&&this._hide_grid(f)}this._reattachColumns(i.id)};this.holdingCells={};this.getHoldingCells=function(t,i,u){if(t.state.hidden||!t.state.opened)return n();for(var e=n(),o=t.children||[],s,h=this.uniq,f=0;f<o.length;f++)s=r(h,o[f])+i,u[s]&&(e=e.add(u[s]).add(this.getHoldingCells(this.get_node(o[f]),i,u)));return e};this._edit=function(t,i,r){if(!t)return!1;if(t.data||(t.data={}),r)r=n(r),r.prop("tagName").toLowerCase()==="div"&&(r=r.children("span:first"));else return!1;var s=this._data.core.rtl,e=this.element.width(),f=t.data[i.text],o=n("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),u=n("<input />",{value:f,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:n.proxy(function(){var n=u.val(),e;n===""||n===f?n=f:(t.data[i.value]=n,this.element.trigger("update_cell.jstree-grid",{node:t,col:i.value,value:n,old:f}),e=d(),this._detachColumns(e),this._prepare_grid(this.get_node(t,!0)),this._reattachColumns(e));u.remove();r.show()},this),keydown:function(n){var t=n.which;t===27&&(this.value=f);(t===27||t===13||t===37||t===38||t===39||t===40||t===32)&&n.stopImmediatePropagation();(t===27||t===13)&&(n.preventDefault(),this.blur())},click:function(n){n.stopImmediatePropagation()},mousedown:function(n){n.stopImmediatePropagation()},keyup:function(){u.width(Math.min(o.text("pW"+this.value).width(),e))},keypress:function(n){if(n.which===13)return!1}}),h={fontFamily:r.css("fontFamily")||"",fontSize:r.css("fontSize")||"",fontWeight:r.css("fontWeight")||"",fontStyle:r.css("fontStyle")||"",fontStretch:r.css("fontStretch")||"",fontVariant:r.css("fontVariant")||"",letterSpacing:r.css("letterSpacing")||"",wordSpacing:r.css("wordSpacing")||""};r.hide();r.parent().append(u);u.css(h).width(Math.min(o.text("pW"+u[0].value).width(),e))[0].select()};this.grid_hide_column=function(n){this.midWrapper.find(".jstree-grid-column-"+n).hide()};this.grid_show_column=function(n){this.midWrapper.find(".jstree-grid-column-"+n).show()};this._prepare_grid=function(i){var l=this._gridSettings,vi=l.treeClass,gt=this,a,st=l.columns||[],ht,wt=l.isThemeroller,rt=this.uniq,ni=l.treecol,bt=this.element,yi=this.rootid,pi=wt?"themeroller":"regular",ut,o=this.get_node(i),wi=l.columnWidth,bi=l.defaultConf,ki=function(t,i,r,u){return function(f){var e=jQuery.Event("select_cell.jstree-grid");t.trigger(e,[{value:r,column:u.header,node:i,grid:n(this),sourceName:u.value}]);e.isDefaultPrevented()||i.children(".jstree-anchor").trigger("click.jstree",f)}},di=function(t,i,r,u,f){return function(e){l.gridcontextmenu&&(e.preventDefault(),n.vakata.context.show(this,{x:e.pageX,y:e.pageY},l.gridcontextmenu(gt,t,i,r,u,f,e.target)))}},gi=function(n,t){return function(){t.hover_node(n)}},nr=function(n,t){return function(){t.dehover_node(n)}},y,ti,ii,ri,k,f,ft,et,kt,ui,ot,ct,dt,lt,d,fi,g,ei,nt,oi,e,tt,tr,ir=this.midWrapper,b,at=o.id,si,hi,vt=this.get_node(o.parent).children,yt=n.inArray(at,vt),ci=this.holdingCells,pt=!1,rr,ur,c,li,ai;if(a=n(i),k=a.children("[class~='jstree-anchor']"),si=k.hasClass(u),hi=k.hasClass("jstree-clicked"),k.length===1){for(rr=!o.state.opened,ct=r(rt,at),dt=o.parent==="#"?null:o.parent,k.addClass(vi),it(k,a,gt),f=k,fi=yt<=0?o.parent:p(this,vt[yt-1]),ei=yt>=vt.length-1?"NULL":vt[yt+1],oi=o.children&&o.children.length>0?o.children[0]:"NULL",ur=this.settings.grid,c=0,li=st.length;c<li;c++)if(ni!==c){e=st[c];b=this._domManipulation==null?ir.children("div:eq("+c+")"):n(this._domManipulation.columns[c]);ti=e.cellClass||"";ii=e.wideCellClass||"";ri=e.columnClass||"";b.addClass(ri);y=s(e.value,o);typeof e.format=="function"&&(y=e.format(y));e.images?(ut=e.images[y]||e.images["default"],ut&&(tt=ut[0]==="*"?'<span class="'+ut.substr(1)+'"><\/span>':'<img src="'+ut+'">')):tt=y;(tt===undefined||tt===null||w.test(tt))&&(tt="&nbsp;");ft=e.valueClass&&o.data!==null&&o.data!==undefined?o.data[e.valueClass]||"":"";ft&&e.valueClassPrefix&&e.valueClassPrefix!==""&&(ft=e.valueClassPrefix+ft);et=e.wideValueClass&&o.data!==null&&o.data!==undefined?o.data[e.wideValueClass]||"":"";et&&e.wideValueClassPrefix&&e.wideValueClassPrefix!==""&&(et=e.wideValueClassPrefix+et);ot=e.title&&o.data!==null&&o.data!==undefined?o.data[e.title]||"":"";ot=ot.replace(v,"");ui=7;ht=e.width||wi;ht!=="auto"&&(ht=tr||ht-ui);f=t(rt,at,c,b);(!f||f.length<1)&&(f=n("<div><\/div>"),n("<span><\/span>").appendTo(f),f.attr("id",ct+c),f.addClass(ct),f.attr(h,at),si?f.addClass(u):f.removeClass(u),hi?f.addClass("jstree-clicked"):f.removeClass("jstree-clicked"),this.settings.core.themes.ellipsis===!0&&c!==ni&&f.addClass("jstree-grid-ellipsis"));o.state.hidden?f.addClass("jstree-grid-hidden"):f.removeClass("jstree-grid-hidden");o.state.disabled?f.addClass("jstree-disabled"):f.removeClass("jstree-disabled");d=t(rt,fi,c,b);g=t(rt,ei,c,b);nt=t(rt,oi,c,b);lt=t(rt,dt,c,b);dt?(lt&&lt.length>0?(d&&d.length>0?f.insertAfter(d):nt&&nt.length>0?f.insertBefore(nt):g&&g.length>0?f.insertBefore(g):f.insertAfter(lt),pt=!0):pt=!1,ci[ct+c]=f):(d&&d.length>0?f.insertAfter(d):nt&&nt.length>0?f.insertBefore(nt):g&&g.length>0?f.insertBefore(g):f.appendTo(b),pt=!0);pt&&(ai=this.getHoldingCells(o,c,ci),f.after(ai));kt=f.children("span");kt.addClass(ti+" "+ft).html(tt);f=f.css(bi).addClass("jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-"+yi+" jstree-grid-cell-"+pi+" "+ii+" "+et+(wt?" ui-state-default":"")).addClass("jstree-grid-col-"+c).addClass("jstree-animated");f.click(ki(bt,a,y,e,this));f.on("contextmenu",di(bt,a,y,e,this));f.hover(gi(a,this),nr(a,this));ot&&kt.attr("title",ot);bt.trigger("render_cell.jstree-grid",[{value:y,column:e.header,node:a,sourceName:e.value}])}f.addClass("jstree-grid-cell-last"+(wt?" ui-state-default":""));st[st.length-1].width===undefined&&f.addClass("jstree-grid-width-auto").next(".jstree-grid-separator").remove()}this.element.css({"overflow-y":"auto !important"})};this.holdingCells={}}});